<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{Roxygen2}
-->

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  error = FALSE,
  tidy = FALSE
)
```


# Introduction to roxygen2

Documentation is one of the most important aspects of good code. Without it, users won't know how to use your package, and are unlikely to do so. Documentation is also useful for you in the future (so you remember what the heck you were thinking!), and for other developers working on your package. The goal of roxygen2 is to make documenting your code as easy as possible. Roxygen uses inline comments, so that you code and documentation are co-located, and provides tools to reuse documentation across multiple functions.

R provides a standard way of documenting packages. You create `.Rd` files in the `man/` directory. These files use a custom syntax, based loosely on latex. Roxygen2 provides a number of advantages over writing `.Rd` files by hand:

* Code and documentation are adjacent so when you modify your code, it's easy
  to remember that you need to update the documentation.

* Roxygen2 dynamically inspects the objects that it's documenting, so it
  automatically add data that you'd otherwise have to include by hand.

* It abstracts over the differences in documenting S3 and S4 methods,
  generics and classes so you need to learn fewer details.

This vignette includes the following sections:

* The basic roxygen process

* Common documentation tags

* Documenting S3, S4 and R5 generics, methods and classes.

## Roxygen process

There are three steps in the transformation from roxygen comments in your source file to human readable documentation:

1. You add roxygen comments to your source file.
2. `roxygen2::roxygenise()` converts roxygen comments to `.Rd` files.
3. R converts `.Rd` files to human readable documentation

The process starts when you add specially formatted roxygen comments to your source file. Roxygen comments start with `#'` so you can continue to use regular comments for other purposes.

```{r}
#' Add together two numbers
#'
#' @param x A number
#' @param y A number
#' @return The sum of \code{x} and \code{y}
#' @examples
#' add(1, 1)
#' add(10, 1)
add <- function(x, y) {
  x + y
}
```

Assuming your working directory is set to your package, you can roxygen comments to `.Rd` files with

* `roxygen::roxygenise()`, or
* `devtools::document()`, if you're already using devtools, or
* `Ctrl + Shift + D`,  if you're using RStudio.

For the example, above, this will generate `man/add.Rd` that looks like:

```
% Generated by roxygen2 (3.2.0): do not edit by hand
\name{add}
\alias{add}
\title{Add together two numbers}
\usage{
add(x, y)
}
\arguments{
  \item{x}{A number}

  \item{y}{A number}
}
\value{
The sum of \code{x} and \code{y}
}
\description{
Add together two numbers
}
\examples{
add(1, 1)
add(10, 1)
}
```

Rd files are a special file format loosely based on LaTeX. You can read more about the Rd format in the [R extensions](http://cran.r-project.org/doc/manuals/R-exts.html#Rd-format) manual. Here we'll avoid discussing Rd files as much as possible, focussing instead on what you need to know about roxygen2.

When you use `?x`, `help("x")` or `example("x")` R looks for an Rd file containing `\alias{x}`. It then parses the file, converts it into html and displays it.

All of these functions look for an Rd file in _installed_ packages. This isn't very useful for package development, because you want to use the `.Rd` files in the _source_ package. `devtools` provides two helpful functions for this scenario: `dev_help()` and `dev_example()`. They behave similarly to `help()` and `example()` but look in source packages you've loaded with `load_all()`, not installed packages you've loaded with `library()`.

## Basic documentation

As you've seen,  roxygen comments have a special format. They start with `#'` and include tags that like `@tagname`. Tags break the documentation up into pieces, and the content of a tag extends from the end of tag name to the start of the next tag (or the end of the block). Because `@` has a special meaning in roxygen, you need to write `@@` to add a literal `@` to the documentation.

Each documentation block starts with a text description. The first sentence becomes the title of the documentation. That's what you see when you look at `help(package = mypackage)` and is shown at the top of the documentation for each package. It should be succinct, written in sentence case, and end in a full stop. The second paragraph is the description: this is shown first in the documentation and should briefly describe what the function does. The third and subsequent paragraphs go into the details: this is a (often long) section that comes after the description of the parameters. It should provide any other important details of how the function operates.

Here's an example showing what the documentation for `sum()` might look like if it had been written with roxygen:

```{r}
#' Sum of vector elements.
#'
#' \code{sum} returns the sum of all the values present in its arguments.
#'
#' This is a generic function: methods can be defined for it directly
#' or via the \code{\link{Summary}} group generic. For this to work properly,
#' the arguments \code{...} should be unnamed, and dispatch is on the
#' first argument.
sum <- function(..., na.rm = TRUE) {}
```

(You'll learn what `\code{}` and `\link{}` mean a little later)

Notice the wrapping of the roxygen block - you should wrap your comments in the same way that you wrap code, keeping them less than ~80 columns wide.

The following documentation is equivalent, but uses explicit tags. This is not necessary unless you want to have a multiple paragraph description or title, or want to omit the description (in which case roxygen will use the title for the description, since it's a required component of the `.Rd` file).

```{r}
#' @title Sum of Vector Elements
#'
#' @description
#' \code{sum} returns the sum of all the values present in its arguments.
#'
#' @details
#' This is a generic function: methods can be defined for it directly
#' or via the \code{\link{Summary}} group generic. For this to work properly,
#' the arguments \code{...} should be unnamed, and dispatch is on the
#' first argument.
sum <- function(..., na.rm = TRUE) {}
```

All objects must have a title, description and details. Objects can also have `@author`, in the form `Firstname Lastname <email@@address.com>`. You only need to use this if the function was written by a non-package author.

Other tags vary based on the type of object you're documenting The following sections describe the other most useful roxygen tags as they pertain to the different types of object you might want to document.

## Documenting functions

The thing you'll document most often is the function. There are three tags that most functions will use:

* `@param name description` describes the inputs to the function.
  The description should provide a succinct summary of the type of the
  parameter (e.g. a string, a numeric vector), and if not obvious from
  the name, what the parameter does. The description can span multiple
  lines (or even paragraphs) if necessary. All parameters must be
  documented.

  It's possible to document multiple arguments at once by separating
  the names with commas (and no whitespace). For example, to document both
  `x` and `y`, you can say `@param x,y Numeric vectors`.

* `@return description` describes the output from the function. This is
  not always necessary, but is a good idea if you return different types
  of outputs depending on the input, or you're returning an S3, S4 or RC
  object.

* `@examples` provides examples of the function in use. This is a very
  important part of the documentation. Many people look at the examples
  before reading anything else in documentation.

Using these elements for the documentation of sum might yield something like this:

```{r}
#' Sum of vector elements.
#'
#' \code{sum} returns the sum of all the values present in its arguments.
#'
#' This is a generic function: methods can be defined for it directly
#' or via the \code{\link{Summary}} group generic. For this to work properly,
#' the arguments \code{...} should be unnamed, and dispatch is on the
#' first argument.
#'
#' @param ... Numeric, complex, or logical vectors.
#' @param na.rm A logical scalar. Should missing values (including NaN)
#'   be removed?
#' @value If all inputs are integer and logical, then the output
#'   will be an integer. If integer overflow occurs, the output will be NA
#'   with a warning. Otherwise it will be a length-one numeric or complex
#'   vector.
#'
#'   Zero-length vectors have sum 0 by definition.
#' @examples
#' sum(1:10)
#' sum(1:5, 6:10)
#' sum(F, F, F, T, T)
sum <- function(..., na.rm = TRUE) {}
```

I recommend indenting the second and subsequent lines of a tag so that when scanning the documentation it's easier to see where one tag ends and the next begins. Tags that always span multiple lines (like `@example`) should start on a new line.

## Aliases and cross-references

* `@seealso` - to provide pointers to other related topics

* `@references` - references to scientific literature on this topic

* `@aliases` - a list of additional topic names that will be mapped to this
  documentation when the user looks them up from the command line.

* `@family` - a family name. All functions that have the same family tag
  will be linked in the documentation.

## Documenting multiple functions in the same file

## S3

### S3 generics

Documenting S3 generics is straightforward: they are functions, so document them as such.

### S3 classes

S3 classes have no formal definition, so document the constructor function.

### S3 methods

It is your choice whether or not to document S3 methods. You don't need to document methods for simple generics like `print()`. If your method is more complicated, you should document it.  In base R, you can find documentation for more complex methods like `predict.lm()`, `predict.glm()`, and `anova.glm()`.

Older versions of roxygen required explicit `@method generic class` tags for all S3 methods. From 3.0.0 this is no longer the case and roxygen2 will generate automatically. If you are upgrading, make sure to remove these old tags. Automatic method detection will only fail if the generic and class are ambiguous. For example is `all.equal.data.frame()` the `equal.data.frame` method for `all`, or the `data.frame` method for `all.equal`?. If this happens, you can disambiguate with `@method all.equal data.frame`.

## S4

Older versions of roxyen2 required explicit `@usage`, `@alias` and `@docType` to correctly document S4 objects, but from version 3.0.0 on roxygen2 generates correct metadata automatically. If you're upgrading from a previous version, make sure to remove these old tags.

### S4 generics

S4 generics are also functions, so document them as such.

### S4 classes

To document an S4 class, add a roxygen block before `setClass()`. Use `@slot` to document the slots of the class. Here's a simple example:

```{r}
#' An S4 class to represent a bank account.
#'
#' @slot balance A length-one numeric vector
Account <- setClass("Account",
  slots = list(balance = "numeric")
)
```

### S4 methods

Unlike S3, all S4 methods must be documented. You can document them in three places:

* In the class. Most appropriate if the corresponding generic uses single
  dispatch and you created the class.

* In the generic. Most appropriate if the generic uses multiple dispatch
  and you control it.

* In it's own file. Most appropriate if the method is complex. or the
  either two options don't apply.

Use `@rdname` to put the method documentation where you want it.

## RC

RC is different to S3 and S4 because it does not have generics and methods are associated with classes, not generics. RC also has a different convention for documenting methods: the doc string. This makes documenting RC classes a little simpler than S4 classes, generics and methods because you only need a single roxygen block per class.

```{r}
#' An S4 class to represent a bank account.
#'
#' @field balance A length-one numeric vector
Account <- setRefClass("Account",
  fields = list(balance = "numeric"),
  methods = list(
    withdraw <- function(x) {
      "Withdraw money from account. Allows overdrafts"
      balance <<- balance - x
    }
  )
)
```

Documented methods will be included in the "Methods" section of the class documentation, along with an automatically generated usage statement.

## Documenting datasets

Datasets are usually stored in `data/` and not as regular R objects in the package. This means you need document them slightly differently: instead of documenting the data directly, you document `NULL`, and use `@name` to tell roxygen2 what you're really documenting.

There are two new tags that are useful for documenting datasets:

* `@format`, which gives an overview of the structure of the dataset. If you omit this, roxygen will automatically add something based on the first line of `str` output

* `@source` where you got the data form, often a `\url{}`.

To show how everything fits together, the example below is an exercept from the roxygen block using to document the diamonds dataset in ggplot2.

```{r}
#' Prices of 50,000 round cut diamonds.
#'
#' A dataset containing the prices and other attributes of almost 54,000
#' diamonds. The variables are as follows:
#'
#' \itemize{
#'   \item price. price in US dollars (\$326--\$18,823)
#'   \item carat. weight of the diamond (0.2--5.01)
#'   ...
#' }
#'
#' @format A data frame with 53940 rows and 10 variables
#' @source \url{http://www.diamondse.info/}
#' @name diamonds
NULL
```

## Documenting packages

As well as documenting every exported object in the package, you should also document the package itself. Package documentation should describe the overall purpose of the package and point to the most important functions. Relatively few packages provide package documentation, but it's an extremely useful tool for users, because instead of just listing functions like `help(package = pkgname)` it organises them and shows the user where to get started.

I usually put this documentation in a `.R` file with the same name as the package.

* Like for data sets, there isn't a object that we can document directly so
  document `NULL` and use `@name` to say what we're actually documenting

* `@docType package` to indicate that it's documenting a package. This will
  automatically add the corect aliases so that `package?yourpackage` works.

* `@references` point to any published material about the package that users
  might find help.

* The topic will be automatically aliases to `package-pkgname` and `pkgname` (unless there is already a function of that name) so that you can find the package help with both `?pkgname` and `package?pkgname`.

The package documentation should not contain a verbatim list of functions or copy of `DESCRIPTION`. This file is for human reading, so pick the most important elements of your package.

